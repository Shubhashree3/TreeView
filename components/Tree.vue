<template>
  <div>
    <ul>
      <li :id="node.id" v-for="node in dataTree" >
        <div class="treeview__level" data-level="A">
          <span class="level-title toggleSpan" @click="toggle(node.id)">
            {{node.label}}
          </span>
          <div class="treeview__level-btns">
            <b-button
              variant="outline-danger"
              class="deleteButton "
              :id="`deleteButton-`+node.id"
              @click="deleteNode(node.id)">
              <FontAwesomeIcon :icon="['fas', 'trash']" />
            </b-button>
            <b-button
              variant="outline-primary"
              class="editButton notVisible"
              :id="`editButton-`+node.id"
              @click="showModal(node)">
              <FontAwesomeIcon :icon="['fas', 'pencil-alt']" />
            </b-button>
            <b-button
              :id="`dropdown-`+node.id"
              variant="outline-success"
              class="level-add visible"
              @click="openMenu(node.id)">
              <FontAwesomeIcon :icon="['fas', 'plus']" />
            </b-button>
          <b-button
            :id="`addSame-`+node.id"
            variant="light"
            @click="addSame(node)"
            class="level-same visible" >
            <span>Add Same Level</span>
          </b-button>
          <b-button
            variant="light"
            @click="addSub(node)"
            class="level-sub"
            :id="`addSub-`+node.id">
            <span>Add Sub Level</span>
          </b-button>
          </div>
        </div>
        <Tree :dataTree="node.childrens" @edit_node = "showModal"/>
      </li>
    </ul>
  </div>
</template>
<script>
export default {
  created() {
  },
  name: 'Tree',
  data() {
    return {
      tree: {
        id: '',
        label: 'abc',
        parentId: '',
      },

    };
  },
  props: ['dataTree'],
  methods: {
    addSame(node) {
      const newNode = {};
      newNode.id = new Date().valueOf();
      newNode.parentId = node.parentId;
      newNode.label = 'New Node';
      this.$store.dispatch('addNode', newNode);
    },
    addSub(node) {
      const newNode = {};
      newNode.id = new Date().valueOf();
      newNode.parentId = node.id;
      newNode.label = 'New Node';
      this.$store.dispatch('addNode', newNode);
    },
    deleteNode(id) {
      this.$store.dispatch('deleteNode', id);
    },
    showModal(node) {
      this.$emit('edit_node', node);
    },
    toggle(id) {
      console.log("here in toggle function")
      const editButton = document.getElementById(`editButton-${id}`);
      const deleteButton = document.getElementById(`deleteButton-${id}`);
      const dropdownButton = document.getElementById(`dropdown-${id}`);
      
      if (! editButton.classList.contains("visible")) {
        
        editButton.classList.add("visible");
        editButton.classList.remove("notVisible");

        deleteButton.classList.add("visible");
        deleteButton.classList.remove("notVisible");
        
        dropdownButton.classList.add("notVisible");
        dropdownButton.classList.remove("visible");
      } 
      else {
        
        editButton.classList.remove("visible");
        editButton.classList.add("notVisible");
        
        deleteButton.classList.remove("visible");
        deleteButton.classList.add("notVisible");
        
        dropdownButton.classList.add("visible");
        dropdownButton.classList.remove("notVisible");
      }
    },
    openMenu(id) {
      $(`#dropdown-${id}`).siblings().toggleClass('in');
    },
  },
};
</script>
<style type="text/css">
.visible {
  display: inherit;
}

.notVisible {
  display: none;
}
</style>
